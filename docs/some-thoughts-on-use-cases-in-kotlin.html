<!DOCTYPE html>

<html>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>
    Some thoughts on use cases in Kotlin - Jordan&#39;s Blog
    
  </title>

  <meta name="description" content="Originally published here on Medium: https://medium.com/@jordanfterry/some-thoughts-on-use-cases-in-kotlin-6ac8021cbcf1">

  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="/blog/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/blog/some-thoughts-on-use-cases-in-kotlin">
  <link rel="alternate" type="application/rss+xml" title="Jordan&#39;s Blog" href="/blog/feed.xml">

</head>


<body>

  <!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/blog/">Jordan&#39;s Blog</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fa fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="/blog/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/about">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/posts">Posts</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/contact">Contact</a>
        </li>
      </ul>
    </div>
  </div>
</nav>


  <!-- Page Header -->

  <header class="masthead">
    
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div class="post-heading">
            <h1>Some thoughts on use cases in Kotlin</h1>
            
            <span class="meta">Posted by
              <a href="#">jordan_terry</a>
              on April 18, 2020 &middot; <span class="reading-time" title="Estimated read time">
  
   5 mins  read </span>

            </span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">

        <p>Originally published here on Medium: <a href="https://medium.com/@jordanfterry/some-thoughts-on-use-cases-in-kotlin-6ac8021cbcf1">https://medium.com/@jordanfterry/some-thoughts-on-use-cases-in-kotlin-6ac8021cbcf1</a></p>

<p>Recently at the Guardian we’ve started to apply the use case pattern to our business logic. A high level overview of a use case is a class that will encapsulate a particular piece of business logic, or behaviour in your app. You may know of this as an interactor pattern as advocated for by <a href="https://blog.cleancoder.com/">Robert Martin</a> in <a href="https://www.amazon.com/Clean-Architecture-Craftsmans-Software-Structure/dp/0134494164">Clean Architecture</a>. They are easy to interpret and test, which will in turn increase both developer productivity and confidence in the quality of a team’s code.</p>

<p>I like to call our use cases “functional use cases”? Why? Well, we make use of <a href="https://kotlinlang.org/docs/reference/operator-overloading.html">operator overloading</a> to override the <code class="language-plaintext highlighter-rouge">invoke</code> function to make execution look like a function. Pretty simple really! Here is an example of how this might look:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;pre class="wp-block-preformatted"&gt;class FunctionalUseCase() {
   operator fun invoke() {
       // Do something snazzy here.
   }
}
</code></pre></div></div>

<p>And when we invoke it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;pre class="wp-block-preformatted"&gt;val useCase = FunctionalUseCase()&lt;br&gt;&lt;/br&gt;useCase() // Not a function, but calling overloaded invoke function
</code></pre></div></div>

<p>It isn’t revolutionary but I like writing our use cases like this. Here are some reasons, and some other musings I have on the topic of use cases.</p>

<p>Overloading the invoke function is straightforward and flexible and allows you to make use of a great Kotlin feature. It is, as you might say, more idiomatic!</p>

<p>It is straightforward because you only have to implement the invoke function and you are good to go. Anyone with knowledge of operator overloading should be able to look at our code and know what is happening.</p>

<p>It is flexible as you can add parameters whatever parameters you like to the invoke function to suit the needs of the particular use case. I think this is great as we can provide any class dependencies as a constructor parameters and provide contextual information as function parameters.</p>

<p>One thing I’ve learned from use case “efforts” in the past is creating an opinionated use case such as one that uses RxJava to handle threading could be a mistake. It might look like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;pre class="wp-block-preformatted"&gt;abstract class SingleUseCase&lt;T&gt;(&lt;br&gt;&lt;/br&gt;    private val observeOn: Scheduler, &lt;br&gt;&lt;/br&gt;    private val subscribeOn: Scheduler&lt;br&gt;&lt;/br&gt;) {
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;pre class="wp-block-preformatted"&gt;    fun execute(): Single&lt;T&gt; {&lt;br&gt;&lt;/br&gt;        return Single&lt;br&gt;&lt;/br&gt;            .fromCallable { doTheUseCase() }&lt;br&gt;&lt;/br&gt;            .observeOn(observeOn)&lt;br&gt;&lt;/br&gt;            .subscribeOn(subscribeOn)&lt;br&gt;&lt;/br&gt;    }
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;pre class="wp-block-preformatted"&gt;    abstract fun doTheUseCase(): T
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;pre class="wp-block-preformatted"&gt;}
</code></pre></div></div>

<p>This could lead to some sneaky misdirection making it hard for developers to find usages of their implementation of the abstract class, as generically wrapping some behaviour in another type will require an abstract function to fill in that behaviour. A developer won’t be able to find all usages of their implementation as their implementation will always be used in the super class.</p>

<p>This is Rx specific, but you may have to implement multiple classes to handle <code class="language-plaintext highlighter-rouge">Observable</code>, <code class="language-plaintext highlighter-rouge">Flowable</code>, <code class="language-plaintext highlighter-rouge">Completable</code> or <code class="language-plaintext highlighter-rouge">Maybe</code> . This just adds a bit of extra complexity to your use cases.</p>

<p>Something I think about regularly is the single responsibility principle (I need more hobbies). It says aclass should only ever have a single reason to change. But in the above implementation, your use case can change if your business rules change or if you decide to stop using RxJava. It breaks SRP in a very subtle way!</p>

<p>Talking of developer experience, there is a particularly annoying gotcha with overloading the invoke function in Kotlin, it relates more to some behaviour in Android Studio/IntelliJ. But lets look at this class:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;pre class="wp-block-preformatted"&gt;class AViewModel(private val useCase: UseCase) {
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;pre class="wp-block-preformatted"&gt;    fun start() {&lt;br&gt;&lt;/br&gt;        useCase()&lt;br&gt;&lt;/br&gt;    }&lt;br&gt;&lt;/br&gt;}
</code></pre></div></div>

<p>If you wanted to go to the source of <code class="language-plaintext highlighter-rouge">useCase</code> you would be forgiven for thinking you could click on <code class="language-plaintext highlighter-rouge">useCase </code>within the <code class="language-plaintext highlighter-rouge">start</code> function but you would be wrong. You will actually be taken to the definition of the property. To be taken to the source you’ll have to carefully aim your cursor on the final bracket: <code class="language-plaintext highlighter-rouge">useCase(&lt;strong&gt;)&lt;/strong&gt;</code><strong>.</strong> This is very frustrating if you are trying to quickly navigate through some code!</p>

<p>This quickly turned into me complaining about some old code I have written and applauding some code I’m currently writing. I expect I’ll change my mind on this in the next year or so, but I hope some of these thoughts will be useful to someone!</p>


        <hr>

        <div class="clearfix">

          
          <a class="btn btn-primary float-left" href="/blog/january-2019-in-sports" data-toggle="tooltip" data-placement="top" title="January 2019 in sports">&larr; Previous<span class="d-none d-md-inline">
              Post</span></a>
          
          
          <a class="btn btn-primary float-right" href="/blog/just-be-decent" data-toggle="tooltip" data-placement="top" title="Just be decent">Next<span class="d-none d-md-inline">
              Post</span> &rarr;</a>
          

        </div>

      </div>
    </div>
  </div>


  <!-- Footer -->

<hr>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <ul class="list-inline text-center">
          
          <li class="list-inline-item">
            <a href="mailto:jordanfterry+blog@gmail.com">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="far fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          
          
          
          
        </ul>
        <p class="copyright text-muted">Copyright &copy;  2023</p>
      </div>
    </div>
  </div>
</footer>


  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/blog/assets/vendor/startbootstrap-clean-blog/js/scripts.js"></script>

<script src="/blog/assets/scripts.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '');
</script>



</body>

</html>
